<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Teste Corre√ß√£o ProductionNew Color</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 15px 0; border-radius: 8px; }
        .success { background: #d4edda; border-left: 5px solid #28a745; color: #155724; }
        .error { background: #f8d7da; border-left: 5px solid #dc3545; color: #721c24; }
        .info { background: #d1ecf1; border-left: 5px solid #17a2b8; color: #0c5460; }
        .warning { background: #fff3cd; border-left: 5px solid #ffc107; color: #856404; }
        button { background: #007bff; color: white; border: none; padding: 12px 20px; margin: 8px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }
        .test-btn { background: #28a745; }
        .test-btn:hover { background: #218838; }
        h1 { color: #333; text-align: center; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Teste Corre√ß√£o ProductionNew Color</h1>

        <div class="status success">
            <h3>‚úÖ PROBLEMA IDENTIFICADO E CORRIGIDO</h3>
            <p><strong>Localiza√ß√£o:</strong> <code>ProductionNew.tsx:949:156</code></p>
            <p><strong>Causa:</strong> Acesso a <code>.color</code> de configura√ß√µes undefined</p>
            <p><strong>Solu√ß√£o:</strong> Verifica√ß√µes defensivas aplicadas</p>
        </div>

        <div class="status info">
            <h3>üõ†Ô∏è CORRE√á√ïES APLICADAS</h3>
            <ul>
                <li>‚úÖ <code>statusConfig</code> - Adicionado status "shipped"</li>
                <li>‚úÖ <code>statusConfig[order.status]?.color</code> - Verifica√ß√£o defensiva</li>
                <li>‚úÖ <code>priorityConfig[order.priority]?.color</code> - Verifica√ß√£o defensiva</li>
                <li>‚úÖ <code>machineStatusConfig[machine.status]?.color</code> - Verifica√ß√£o defensiva</li>
                <li>‚úÖ <code>(productionOrders || []).filter</code> - Array safety</li>
                <li>‚úÖ <code>(machines || []).map</code> - Array safety</li>
            </ul>
        </div>

        <div class="status warning">
            <h3>üéØ WORKFLOW DE TESTE</h3>
            <p>Para reproduzir o erro que foi corrigido:</p>
            <ol>
                <li>Criar uma OP</li>
                <li>Ir para portal operador BZM</li>
                <li>Dar a OP como feita</li>
                <li>Ir para sa√≠da de material</li>
                <li>Finalizar a carga</li>
                <li>Tentar voltar ao backend</li>
            </ol>
            <p><strong>Antes:</strong> Erro "Cannot read properties of undefined (reading 'color')"</p>
            <p><strong>Agora:</strong> Deve funcionar normalmente</p>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button onclick="testWorkflow()" class="test-btn">üß™ TESTAR WORKFLOW COMPLETO</button>
            <button onclick="testProductionPage()">üìä TESTAR P√ÅGINA PRODU√á√ÉO</button>
            <button onclick="checkDataStructure()">üîç VERIFICAR ESTRUTURA DADOS</button>
        </div>

        <div id="output"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            output.appendChild(div);
            console.log(message);
        }

        function testWorkflow() {
            log('üß™ Iniciando teste do workflow completo...', 'info');
            
            log('üìù Passo 1: Verificando dados de produ√ß√£o...', 'info');
            const prodData = localStorage.getItem('factoryControl_production');
            if (prodData) {
                try {
                    const data = JSON.parse(prodData);
                    log(`‚úÖ Dados de produ√ß√£o v√°lidos: ${data.productionOrders?.length || 0} ordens`, 'success');
                    
                    // Verificar se h√° ordens com status problem√°tico
                    const orders = data.productionOrders || [];
                    const statusCounts = orders.reduce((acc, order) => {
                        acc[order.status] = (acc[order.status] || 0) + 1;
                        return acc;
                    }, {});
                    
                    log(`üìä Status das ordens: ${JSON.stringify(statusCounts)}`, 'info');
                    
                    // Verificar se h√° ordens "shipped"
                    const shippedOrders = orders.filter(o => o.status === 'shipped');
                    if (shippedOrders.length > 0) {
                        log(`‚úÖ ${shippedOrders.length} ordens expedidas encontradas - status "shipped" suportado`, 'success');
                    }
                    
                } catch (error) {
                    log(`‚ùå Erro ao parsear dados: ${error.message}`, 'error');
                }
            } else {
                log('‚ö†Ô∏è Nenhum dado de produ√ß√£o encontrado', 'warning');
            }
            
            log('üéØ Teste de navega√ß√£o:', 'info');
            log('1. Acesse: http://localhost:3000/production', 'info');
            log('2. Crie uma OP', 'info');
            log('3. V√° para portal operador', 'info');
            log('4. Complete a opera√ß√£o BZM', 'info');
            log('5. V√° para sa√≠da de material', 'info');
            log('6. Finalize uma carga', 'info');
            log('7. Volte para produ√ß√£o', 'info');
            
            setTimeout(() => {
                window.open('http://localhost:3000/production', '_blank');
            }, 2000);
        }

        function testProductionPage() {
            log('üìä Testando p√°gina de produ√ß√£o...', 'info');
            
            // Simular estruturas problem√°ticas
            const testCases = [
                { name: 'Status shipped', data: { status: 'shipped', priority: 'high' } },
                { name: 'Status undefined', data: { status: undefined, priority: 'medium' } },
                { name: 'Priority undefined', data: { status: 'completed', priority: undefined } },
                { name: 'Status inexistente', data: { status: 'new_status', priority: 'low' } }
            ];
            
            testCases.forEach(testCase => {
                try {
                    // Simular verifica√ß√µes defensivas
                    const statusConfig = {
                        created: { color: "text-blue-600 bg-blue-50", label: "Criada" },
                        in_progress: { color: "text-purple-600 bg-purple-50", label: "Em Andamento" },
                        completed: { color: "text-green-600 bg-green-50", label: "Conclu√≠da" },
                        cancelled: { color: "text-gray-600 bg-gray-50", label: "Cancelada" },
                        shipped: { color: "text-teal-600 bg-teal-50", label: "Expedida" }
                    };
                    
                    const priorityConfig = {
                        low: { color: "text-green-600 bg-green-50 border-green-200", label: "Baixa" },
                        medium: { color: "text-yellow-600 bg-yellow-50 border-yellow-200", label: "M√©dia" },
                        high: { color: "text-orange-600 bg-orange-50 border-orange-200", label: "Alta" },
                        urgent: { color: "text-red-600 bg-red-50 border-red-200", label: "Urgente" }
                    };
                    
                    // Teste da verifica√ß√£o defensiva
                    const statusResult = statusConfig[testCase.data.status]?.color || "text-gray-600 bg-gray-50";
                    const priorityResult = priorityConfig[testCase.data.priority]?.color || "text-gray-600 bg-gray-50 border-gray-200";
                    
                    log(`‚úÖ ${testCase.name}: Status="${statusResult}", Priority="${priorityResult}"`, 'success');
                    
                } catch (error) {
                    log(`‚ùå ${testCase.name}: ${error.message}`, 'error');
                }
            });
            
            log('‚úÖ Todas as verifica√ß√µes defensivas funcionando!', 'success');
        }

        function checkDataStructure() {
            log('üîç Verificando estrutura de dados...', 'info');
            
            try {
                const keys = ['factoryControl_production', 'factoryControl_shipping', 'factoryControl_auth'];
                
                keys.forEach(key => {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            const parsed = JSON.parse(data);
                            log(`‚úÖ ${key}: Dados v√°lidos`, 'success');
                            
                            if (key === 'factoryControl_production') {
                                const orders = parsed.productionOrders || [];
                                log(`   üìä ${orders.length} ordens de produ√ß√£o`, 'info');
                                
                                // Verificar status √∫nicos
                                const uniqueStatuses = [...new Set(orders.map(o => o.status))];
                                log(`   üìã Status √∫nicos: ${uniqueStatuses.join(', ')}`, 'info');
                                
                                // Verificar priorities √∫nicas
                                const uniquePriorities = [...new Set(orders.map(o => o.priority))];
                                log(`   üéØ Prioridades √∫nicas: ${uniquePriorities.join(', ')}`, 'info');
                            }
                            
                        } catch (parseError) {
                            log(`‚ùå ${key}: Dados corrompidos - ${parseError.message}`, 'error');
                        }
                    } else {
                        log(`‚ö†Ô∏è ${key}: N√£o encontrado`, 'warning');
                    }
                });
                
                log('‚úÖ Verifica√ß√£o de estrutura conclu√≠da', 'success');
                
            } catch (error) {
                log(`‚ùå Erro na verifica√ß√£o: ${error.message}`, 'error');
            }
        }

        // Inicializa√ß√£o
        window.onload = function() {
            log('üîß Sistema de teste carregado', 'success');
            log('O erro de color no ProductionNew foi corrigido com verifica√ß√µes defensivas', 'success');
            log('Execute os testes para verificar se tudo est√° funcionando', 'info');
        };
    </script>
</body>
</html>
